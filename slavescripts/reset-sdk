#!/bin/sh -e

if [ "$1" = "--beta" ]; then
    SDK_TARBALL=lsb-beta-sdk.tar.gz
else
    SDK_TARBALL=lsb-released-sdk.tar.gz
fi

mkdir -p $HOME/tmp
[ -e $HOME/$SDK_TARBALL ]

# SDK packages besides lsb-build-base, which has to be handled specially.
SDK_PKGS="lsb-build-cc lsb-build-c++ lsb-build-desktop lsb-build-qt3 lsb-build-qt4 lsb-makelsbpkg"

for pkg in $SDK_PKGS; do
  sudo rpm --nodeps --allmatches -e $pkg || true
done
sudo rpm --nodeps --allmatches -e lsb-build-libbat || true
sudo rpm --nodeps --allmatches -e lsb-build-base || true

(cd $HOME/tmp && zcat $HOME/$SDK_TARBALL | tar xf -)

rpm -q lsb-setup > /dev/null 2>&1
if [ $? -ne 0 ]; then
  sudo rpm -Uvh --force $HOME/tmp/lsb-sdk/lsb-setup*rpm
fi

sudo rpm -Uvh --force $HOME/tmp/lsb-sdk/lsb-build-base*
for pkg in $SDK_PKGS; do
  sudo rpm -Uvh --force $HOME/tmp/lsb-sdk/$pkg*
done

rm -rf $HOME/tmp/lsb-sdk
